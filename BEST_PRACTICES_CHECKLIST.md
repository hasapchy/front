# Чеклист лучших практик (Frontend)

Состояние на основе анализа кодовой базы. Отмечайте по мере внедрения.

---

## Запросы и сеть

| # | Практика | Статус | Где смотреть / что сделать |
|---|----------|--------|----------------------------|
| 1 | **Отмена запросов (AbortController)** | ❌ Нет | Поиск (ClientSearch, OrderSearch, ProductSearch и др.) и фильтры: при новом вводе отменять предыдущий запрос, чтобы старый ответ не перезаписывал актуальный. В axios передавать `signal` из `AbortController`. |
| 2 | **Повтор при ошибке (retry)** | ✅ Есть | `cache/utils.js` — `retryWithExponentialBackoff`, используется в store и cache/loader. |
| 3 | **Таймаут запросов** | ❌ Нет | В `api/axiosInstance.js` нет `timeout`. Добавить в `axios.create({ timeout: 30000 })` или в интерцептор. В lang есть ключ `loadTimeout` для сообщений. |

---

## Формы и UX

| # | Практика | Статус | Где смотреть / что сделать |
|---|----------|--------|----------------------------|
| 4 | **Фокус в модалках** | ⚠️ Частично | Есть `autofocus` на LoginPage, `$refs.composerTextarea?.focus()` в MessengerPage, `focus()` в UserSearch и TaskChecklist. В SideModalDialog и AlertDialog при открытии не ставится фокус на первый инпут/кнопку и не возвращается при закрытии. Добавить хук при открытии модалки: фокус на первый инпут или кнопку; при закрытии — возврат на элемент, открывший модалку. |
| 5 | **Горячие клавиши** | ⚠️ Частично | Enter/Shift+Enter/Esc в мессенджере и TaskChecklist, Enter в формах (addPhone, addEmail и т.д.). Нет единого Ctrl+S для сохранения формы и Esc для закрытия модалки. Сделать миксин (напр. `keyboardShortcutsMixin`) и подключать на страницах с формами и модалками. |
| 6 | **Защита от потери данных** | ⚠️ Частично | `formChangesMixin` + диалог «Несохранённые изменения» используются во многих Create-страницах при закрытии через кнопку. Нет `beforeunload`: при закрытии вкладки/браузера с несохранённой формой предупреждение не показывается. В миксине добавить `window.addEventListener('beforeunload', handler)` при наличии изменений. |

---

## Отображение и загрузка

| # | Практика | Статус | Где смотреть / что сделать |
|---|----------|--------|----------------------------|
| 7 | **Скелетоны вместо спиннеров** | ⚠️ Частично | В `assets/app.css` есть стили `#table-skeleton`; в компонентах по проекту скелетон не используется — везде SpinnerIcon или текст «Загрузка…». Ввести компонент скелетона и использовать для списков/таблиц вместо одного спиннера. |
| 8 | **Глобальный обработчик ошибок** | ❌ Нет | В `main.js` не заданы `app.config.errorHandler` и обработчик `window.onunhandledrejection`. Добавить: логирование + показ пользователю сообщения об ошибке (и при желании отправка в систему мониторинга). |

---

## Доступность и стабильность

| # | Практика | Статус | Где смотреть / что сделать |
|---|----------|--------|----------------------------|
| 9 | **A11y (aria, роли)** | ⚠️ Частично | Есть отдельные `aria-label` (FieldHint, AppSidebarComponent, AppHeaderComponent, ScrollToTopButton). У модалок (SideModalDialog, AlertDialog) нет `role="dialog"`, `aria-modal="true"`, `aria-labelledby`. У кнопок только с иконкой (PrimaryButton с icon без текста) не везде есть `aria-label`/`title`. Дополнить модалки и иконочные кнопки. |
| 10 | **Очередь уведомлений (toast)** | ✅ Сделано | Используется **vue3-toastify**: несколько тостов одновременно (лимит 5), анимация `bounce`, позиция top-right. Управление через store: `showNotification` вызывает `toast.success`/`toast.error` и звуки; `closeNotification` — `toast.clearAll()`. |

---

## Данные и кэш

| # | Практика | Статус | Где смотреть / что сделать |
|---|----------|--------|----------------------------|
| 11 | **Инвалидация после мутаций** | ⚠️ Проверить | После create/update/delete списки должны обновляться (перезапрос или обновление store). Реализовано через эмиты `saved`/`deleted` и перезагрузку данных на страницах. Стоит выборочно проверить сценарии: создал запись → список обновился без ручного F5. |
| 12 | **Состояние «пусто»** | ⚠️ Частично | Есть использование `$t('noData')` в SimpleStockSearch, SimpleProductSearch, SimpleServicesRow, DraggableTable, KanbanColumn (`emptyText`). Не везде у списков/таблиц явный экран «здесь пока ничего нет» с подсказкой (например «Добавить первый заказ»). Унифицировать пустые состояния на страницах списков. |

---

## Уже в хорошем состоянии

- **Debounce** — поиск и фильтры (ClientSearch, OrderSearch, ContractSearch, ProductSearch, UserSearch и др., LeavesPage, CompanyHolidaysPage, OrdersPage/TasksPage/ProjectsPage для смены статуса).
- **Loading на кнопках** — `saveLoading`/`deleteLoading` через crudFormMixin и PrimaryButton (`:is-loading`), в т.ч. после недавних правок на OrderCreatePage и MessengerPage.
- **Защита от двойной отправки** — через `saveLoading` и `disabled` на кнопках.
- **Retry** — `retryWithExponentialBackoff` в store и cache.
- **Флаг несохранённых изменений** — formChangesMixin и диалог при закрытии формы (без beforeunload).

---

## Рекомендуемый приоритет

1. Таймаут запросов (axios) — быстро, снижает «зависание» при проблемах с сетью.
2. Глобальный errorHandler + unhandledrejection — одна точка обработки ошибок.
3. beforeunload в formChangesMixin — защита при закрытии вкладки.
4. AbortController в поиске — улучшение UX при быстром вводе.
5. Фокус в модалках и клавиши Ctrl+S / Esc — удобство и a11y.
6. A11y для модалок и иконочных кнопок.
7. Скелетоны и единые пустые состояния — по желанию и ресурсам.
