<template>
  <div
    ref="root"
    class="emoji-picker absolute w-[320px] h-[340px] bg-white border border-gray-300 rounded-lg shadow-sm flex flex-col z-50"
    :class="[
      positionBelow ? 'top-full mt-1' : 'bottom-full mb-1',
      alignRight ? 'right-0' : 'left-0'
    ]"
    role="dialog"
    aria-label="–í—ã–±–æ—Ä —Å–º–∞–π–ª–∏–∫–∞"
  >
    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è (–¥–ª—è –ø–∏–∫–µ—Ä–∞ —Ä–µ–∞–∫—Ü–∏–π) -->
    <button
      v-if="showCloseButton"
      type="button"
      class="absolute top-1.5 right-1.5 w-7 h-7 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 text-gray-600 text-lg leading-none z-10"
      title="–ó–∞–∫—Ä—ã—Ç—å"
      aria-label="–ó–∞–∫—Ä—ã—Ç—å"
      @click="$emit('close')"
    >
      √ó
    </button>
    <!-- –í–∫–ª–∞–¥–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ —Å—Ç–∏–ª–µ Telegram -->
    <div class="flex shrink-0 border-b border-gray-300 px-1 pt-1 gap-1">
      <button
        v-for="cat in visibleCategories"
        :key="cat.id"
        type="button"
        class="w-8 h-8 flex items-center justify-center text-base hover:bg-gray-100 rounded transition-colors relative"
        :title="cat.label"
        @click="activeCategoryId = cat.id"
      >
        {{ cat.icon }}
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ (–∫–∞–∫ –≤ Telegram) -->
        <div 
          v-if="activeCategoryId === cat.id"
          class="absolute bottom-0 left-1 right-1 h-0.5 bg-blue-500 rounded-t"
        ></div>
      </button>
    </div>

    <!-- –ü–æ–∏—Å–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∫–∞–∫ –≤ Telegram) -->
    <div class="px-3 py-2 border-b border-gray-300">
      <input
        type="text"
        placeholder="–ü–æ–∏—Å–∫ —ç–º–æ–¥–∑–∏"
        class="w-full px-3 py-1.5 text-sm bg-gray-100 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-300"
        v-model="searchQuery"
      />
    </div>

    <!-- –°–µ—Ç–∫–∞ —ç–º–æ–¥–∑–∏ —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π -->
    <div class="flex-1 overflow-y-auto p-2 min-h-0">
      <div
        v-for="cat in filteredCategories"
        v-show="activeCategoryId === cat.id && (!searchQuery || cat.id === 'search')"
        :key="cat.id"
        class="grid grid-cols-9 gap-0"
      >
        <button
          v-for="(emoji, idx) in getEmojisForCategory(cat)"
          :key="`${cat.id}-${idx}`"
          type="button"
          class="w-9 h-9 flex items-center justify-center text-2xl hover:bg-gray-100 rounded transition-colors relative"
          @click="onSelect(emoji)"
          @mouseenter="hoveredEmoji = emoji"
          @mouseleave="hoveredEmoji = null"
        >
          {{ emoji }}
          <!-- –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (–∫–∞–∫ –≤ Telegram) -->
          <div 
            v-if="hoveredEmoji === emoji"
            class="absolute inset-0 bg-gray-200 opacity-50 rounded"
          ></div>
        </button>
      </div>
    </div>

    <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ —ç–º–æ–¥–∑–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (–∫–∞–∫ –≤ Telegram) -->
    <div 
      v-if="hoveredEmoji"
      class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-sm rounded-lg opacity-90"
    >
      {{ hoveredEmoji }} :{{ getEmojiName(hoveredEmoji) }}:
    </div>
  </div>
</template>

<script>
const RECENT_STORAGE_KEY = 'messenger_recent_emojis'
const RECENT_MAX = 36

const EMOJI_CATEGORIES = [
  {
    id: 'recent',
    label: '–ù–µ–¥–∞–≤–Ω–∏–µ',
    icon: 'üïí',
    emojis: []
  },
  {
    id: 'smileys',
    label: '–°–º–∞–π–ª—ã –∏ –ª—é–¥–∏',
    icon: 'üòÄ',
    emojis: ['üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÖ', 'üòÇ', 'ü§£', 'üòä', 'üòá', 'üôÇ', 'üôÉ', 'üòâ', 'üòå', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòô', 'üòö', 'üòã', 'üòõ', 'üòù', 'üòú', 'ü§™', 'ü§®', 'üßê', 'ü§ì', 'üòé', 'ü•∏', 'ü§©', 'ü•≥', 'üòè', 'üòí', 'üòû', 'üòî', 'üòü', 'üòï', 'üôÅ', '‚òπÔ∏è', 'üò£', 'üòñ', 'üò´', 'üò©', 'ü•∫', 'üò¢', 'üò≠', 'üò§', 'üò†', 'üò°', 'ü§¨', 'ü§Ø', 'üò≥', 'ü•µ', 'ü•∂', 'üò±', 'üò®', 'üò∞', 'üò•', 'üòì', 'ü§ó', 'ü§î', 'ü§≠', 'ü§´', 'ü§•', 'üò∂', 'üòê', 'üòë', 'üò¨', 'üôÑ', 'üòØ', 'üò¶', 'üòß', 'üòÆ', 'üò≤', 'ü•±', 'üò¥', 'ü§§', 'üò™', 'üòµ', 'ü§ê', 'ü•¥', 'ü§¢', 'ü§Æ', 'ü§ß', 'üò∑', 'ü§í', 'ü§ï', 'ü§ë', 'ü§†']
  },
  {
    id: 'animals',
    label: '–ñ–∏–≤–æ—Ç–Ω—ã–µ –∏ –ø—Ä–∏—Ä–æ–¥–∞',
    icon: 'üê∂',
    emojis: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üêª‚Äç‚ùÑÔ∏è', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üêΩ', 'üê∏', 'üêµ', 'üôà', 'üôâ', 'üôä', 'üêí', 'üêî', 'üêß', 'üê¶', 'üê§', 'üê£', 'üê•', 'ü¶Ü', 'ü¶Ö', 'ü¶â', 'ü¶á', 'üê∫', 'üêó', 'üê¥', 'ü¶Ñ', 'üêù', 'ü™±', 'üêõ', 'ü¶ã', 'üêå', 'üêû', 'üêú', 'ü™∞', 'ü™≤', 'ü™≥', 'üê¢', 'üêç', 'ü¶é', 'ü¶ñ', 'ü¶ï', 'üêô', 'ü¶ë', 'ü¶ê', 'ü¶û', 'ü¶Ä', 'üê°', 'üê†', 'üêü', 'üê¨', 'üê≥', 'üêã', 'ü¶à', 'üêä', 'üêÖ', 'üêÜ', 'ü¶ì', 'ü¶ç', 'ü¶ß', 'ü¶£', 'üêò', 'ü¶õ', 'ü¶è', 'üê™', 'üê´', 'ü¶í', 'ü¶ò', 'üêÉ', 'üêÇ', 'üêÑ', 'üêé', 'üêñ', 'üêè', 'üêë', 'ü¶ô', 'üêê', 'ü¶å', 'üêï', 'üê©', 'ü¶Æ', 'üêï‚Äçü¶∫', 'üêà', 'üêà‚Äç‚¨õ', 'ü™∂', 'üêì', 'ü¶É', 'ü¶§', 'ü¶ö', 'ü¶ú', 'ü¶¢', 'ü¶©', 'üïäÔ∏è', 'üêá', 'ü¶ù', 'ü¶®', 'ü¶°', 'ü¶´', 'ü¶¶', 'ü¶•', 'üêÅ', 'üêÄ', 'üêøÔ∏è', 'ü¶î', 'üêæ', 'üêâ', 'üê≤', 'üåµ', 'üéÑ', 'üå≤', 'üå≥', 'üå¥', 'ü™µ', 'üå±', 'üåø', '‚òòÔ∏è', 'üçÄ', 'üéç', 'ü™¥', 'üéã', 'üçÉ', 'üçÇ', 'üçÅ', 'ü™∫', 'ü™π', 'üçÑ', 'üêö', 'ü™∏', 'üåæ', 'üíê', 'üå∑', 'üåπ', 'ü•Ä', 'üå∫', 'üå∏', 'üåº', 'üåª']
  },
  {
    id: 'food',
    label: '–ï–¥–∞ –∏ –Ω–∞–ø–∏—Ç–∫–∏',
    icon: 'üçá',
    emojis: ['üçá', 'üçà', 'üçâ', 'üçä', 'üçã', 'üçå', 'üçç', 'ü•≠', 'üçé', 'üçè', 'üçê', 'üçë', 'üçí', 'üçì', 'ü´ê', 'ü•ù', 'üçÖ', 'ü´í', 'ü••', 'ü•ë', 'üçÜ', 'ü•î', 'ü•ï', 'üåΩ', 'üå∂Ô∏è', 'ü´ë', 'ü•í', 'ü•¨', 'ü•¶', 'üßÑ', 'üßÖ', 'üçÑ', 'ü•ú', 'üå∞', 'üçû', 'ü•ê', 'ü•ñ', 'ü´ì', 'ü•®', 'ü•Ø', 'ü•û', 'üßá', 'üçñ', 'üçó', 'ü•©', 'ü•ì', 'üçî', 'üçü', 'üçï', 'üå≠', 'ü•™', 'üåÆ', 'üåØ', 'ü´î', 'ü•ô', 'üßÜ', 'ü•ö', 'üç≥', 'ü•ò', 'üç≤', 'ü´ï', 'ü•£', 'ü•ó', 'üçø', 'üßà', 'üßÇ', 'ü•´', 'üç±', 'üçò', 'üçô', 'üçö', 'üçõ', 'üçú', 'üçù', 'üç†', 'üç¢', 'üç£', 'üç§', 'üç•', 'ü•Æ', 'üç°', 'ü•ü', 'ü•†', 'ü•°', 'ü¶Ä', 'ü¶û', 'ü¶ê', 'ü¶ë', 'üç¶', 'üçß', 'üç®', 'üç©', 'üç™', 'üéÇ', 'üç∞', 'üßÅ', 'ü•ß', 'üç´', 'üç¨', 'üç≠', 'üçÆ', 'üçØ', 'üçº', 'ü•õ', '‚òï', 'üçµ', 'üç∂', 'üçæ', 'üç∑', 'üç∏', 'üçπ', 'üç∫', 'üçª', 'ü•Ç', 'ü•É', 'ü•§', 'üßã', 'üßÉ', 'üßâ', 'üßä']
  },
  {
    id: 'activities',
    label: '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏',
    icon: '‚öΩ',
    emojis: ['‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'ü•é', 'üéæ', 'üèê', 'üèâ', 'ü•è', 'üé±', 'ü™Ä', 'üèì', 'üè∏', 'üèí', 'üèë', 'ü•ç', 'üèè', 'ü™É', 'ü•Ö', '‚õ≥', 'ü™Å', 'üèπ', 'üé£', 'ü§ø', 'ü•ä', 'ü•ã', 'üéΩ', 'üõπ', 'üõº', 'üõ∑', '‚õ∏Ô∏è', 'ü•å', 'üéø', '‚õ∑Ô∏è', 'üèÇ', 'ü™Ç', 'üèãÔ∏è', 'ü§º', 'ü§∏', '‚õπÔ∏è', 'ü§∫', 'ü§æ', 'üèåÔ∏è', 'üèá', 'üßò', 'üèÑ', 'üèä', 'ü§Ω', 'üö£', 'üßó', 'üöµ', 'üö¥', 'üèÜ', 'ü•á', 'ü•à', 'ü•â', 'üèÖ', 'üéñÔ∏è', 'üèµÔ∏è', 'üéóÔ∏è', 'üé´', 'üéüÔ∏è', 'üé™', 'ü§π', 'üé≠', 'ü©∞', 'üé®', 'üé¨', 'üé§', 'üéß', 'üéº', 'üéπ', 'ü•Å', 'ü™ò', 'üé∑', 'üé∫', 'üé∏', 'ü™ï', 'üéª', 'üé≤', '‚ôüÔ∏è', 'üÉè', 'üÄÑ', 'üé¥', 'üéØ', 'ü™Ñ', 'üß©', 'üöó', 'üöï', 'üöô', 'üöå', 'üöé', 'üèéÔ∏è', 'üöì', 'üöë', 'üöí', 'üöê', 'üöö', 'üöõ', 'üöú', 'üõ∫', 'üöî', 'üöç', 'üöò', 'üöñ', 'üõª', 'üö†', 'üö°', 'üöü', 'üöÉ', 'üöã', 'üöû', 'üöù', 'üöÑ', 'üöÖ', 'üöà', 'üöÇ', 'üöÜ', 'üöá', 'üöä', 'üöâ', '‚úàÔ∏è', 'üõ´', 'üõ¨', 'üõ©Ô∏è', 'üí∫', 'üõ∞Ô∏è', 'üöÄ', 'üõ∏', 'üöÅ', 'üõ∂', '‚õµ', 'üö§', 'üõ•Ô∏è', 'üõ≥Ô∏è', '‚õ¥Ô∏è', 'üö¢', '‚öì', 'ü™ù', 'üå†', 'üéá', 'üéÜ', 'üß®', '‚ú®', 'üéà', 'üéâ', 'üéä', 'üéã', 'üéç', 'üéé', 'üéè', 'üéê', 'üéë', 'üßß', 'üéÄ', 'üéÅ', 'üé´', 'üéüÔ∏è', 'üé≠', 'üé®', 'üé™', 'ü§π', 'ü©∞']
  },
  {
    id: 'objects',
    label: '–ü—Ä–µ–¥–º–µ—Ç—ã',
    icon: 'üí°',
    emojis: ['üí°', 'üî¶', 'üèÆ', 'ü™î', 'üìî', 'üìï', 'üìñ', 'üìó', 'üìò', 'üìô', 'üìö', 'üìì', 'üìí', 'üìÉ', 'üìú', 'üìÑ', 'üì∞', 'üóûÔ∏è', 'üìë', 'üîñ', 'üè∑Ô∏è', 'üí∞', 'ü™ô', 'üí¥', 'üíµ', 'üí∂', 'üí∑', 'üí∏', 'üí≥', 'üßæ', 'üíé', '‚öñÔ∏è', 'ü™ú', 'üß∞', 'ü™õ', 'üîß', 'üî®', '‚öíÔ∏è', 'üõ†Ô∏è', '‚õèÔ∏è', 'üî©', '‚öôÔ∏è', 'üß±', 'ü™ö', 'üß≤', 'ü™ú', 'üß™', 'üß´', 'üß¨', 'üî¨', 'üî≠', 'üì°', 'üíâ', 'ü©∏', 'üíä', 'ü©π', 'ü©∫', 'üö™', 'ü™ë', 'üõãÔ∏è', 'üõèÔ∏è', 'üõå', 'üß∏', 'ü™Ü', 'üñºÔ∏è', 'ü™û', 'ü™ü', 'üõçÔ∏è', 'üõí', 'üéÅ', 'üéà', 'üéè', 'üéÄ', 'ü™Ñ', 'üßß', 'üéä', 'üéâ', 'üéé', 'üèÆ', 'üéê', 'üßø', 'üìø', 'üìØ', 'üéôÔ∏è', 'üéöÔ∏è', 'üéõÔ∏è', 'üìª', 'üì±', 'üì≤', '‚òéÔ∏è', 'üìû', 'üìü', 'üì†', 'üîã', 'ü™´', 'üîå', 'üíª', 'üñ•Ô∏è', 'üñ®Ô∏è', '‚å®Ô∏è', 'üñ±Ô∏è', 'üñ≤Ô∏è', 'üíΩ', 'üíæ', 'üíø', 'üìÄ', 'üßÆ', 'üé•', 'üìΩÔ∏è', 'üéûÔ∏è', 'üìû', 'üìü', 'üì†', 'üì∫', 'üì∑', 'üì∏', 'üìπ', 'üìº', 'üîç', 'üîé', 'üïØÔ∏è', 'üí°', 'üî¶', 'üèÆ', 'üìî', 'üìï', 'üìñ', 'üìó', 'üìò', 'üìô', 'üìö', 'üìì', 'üìí', 'üìÉ', 'üìú', 'üìÑ', 'üì∞', 'üóûÔ∏è', 'üìë', 'üîñ', 'üè∑Ô∏è', 'üí∞', 'üí¥', 'üíµ', 'üí∂', 'üí∑', 'üí∏', 'üí≥', '‚úâÔ∏è', 'üìß', 'üì®', 'üì©', 'üì§', 'üì•', 'üì¶', 'üì´', 'üì™', 'üì¨', 'üì≠', 'üìÆ', 'üó≥Ô∏è', '‚úèÔ∏è', '‚úíÔ∏è', 'üñãÔ∏è', 'üñäÔ∏è', 'üñåÔ∏è', 'üñçÔ∏è', 'üìù', 'üíº', 'üìÅ', 'üìÇ', 'üóÇÔ∏è', 'üìÖ', 'üìÜ', 'üóíÔ∏è', 'üóìÔ∏è', 'üìá', 'üìà', 'üìâ', 'üìä', 'üìã', 'üìå', 'üìç', 'üìé', 'üñáÔ∏è', 'üìè', 'üìê', '‚úÇÔ∏è', 'üóÉÔ∏è', 'üóÑÔ∏è', 'üóëÔ∏è', 'üîí', 'üîì', 'üîè', 'üîê', 'üîë', 'üóùÔ∏è', 'üî®', 'ü™ì', '‚õèÔ∏è', '‚öíÔ∏è', 'üõ†Ô∏è', 'üó°Ô∏è', '‚öîÔ∏è', 'üî´', 'ü™É', 'üèπ', 'üõ°Ô∏è', 'üîß', 'ü™õ', 'üî©', '‚öôÔ∏è', 'üóúÔ∏è', '‚öñÔ∏è', 'ü¶Ø', 'üîó', '‚õìÔ∏è', 'ü™ù', 'üß∞', 'üß≤', 'ü™ú', 'üß™', 'üß´', 'üß¨', 'üî¨', 'üî≠', 'üì°', 'üíâ', 'ü©∏', 'üíä', 'ü©π', 'ü©∫', 'üö™', 'ü™ë', 'üõãÔ∏è', 'üõèÔ∏è', 'üõå', 'üß∏', 'ü™Ü', 'üñºÔ∏è', 'ü™û', 'ü™ü', 'üõçÔ∏è', 'üõí', 'üöΩ', 'ü™†', 'üöø', 'üõÅ', 'ü™•', 'ü™í', 'üß¥', 'üß∑', 'üßπ', 'üß∫', 'üßª', 'ü™£', 'üßº', 'ü™•', 'üßΩ', 'üßØ', 'üõí', 'üö¨', '‚ö∞Ô∏è', 'ü™¶', '‚ö±Ô∏è', 'üè∫', 'üîÆ', 'üìø', 'üßø', 'üíà', '‚öóÔ∏è', 'üî≠', 'üî¨', 'üï≥Ô∏è', 'ü©ª', 'ü©º', 'üíä', 'üíâ', 'ü©∫', 'üå°Ô∏è', 'üß¨', 'ü¶†', 'üß´', 'üß™', 'üßª', 'ü©π', 'ü©∫', 'ü©∏', 'üíÄ', '‚ò†Ô∏è', 'ü¶¥', 'ü¶∑', 'üëÅÔ∏è', 'üëÇ', 'üëÉ', 'üß†', 'ü´Ä', 'ü´Å', 'ü¶∂', 'ü¶µ', 'ü¶ø', 'ü¶æ', 'üíÑ', 'üíç', 'üíº']
  },
  {
    id: 'symbols',
    label: '–°–∏–º–≤–æ–ª—ã',
    icon: '‚ù§Ô∏è',
    emojis: ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç', 'ü§é', 'üíî', '‚ù§Ô∏è‚Äçüî•', '‚ù§Ô∏è‚Äçü©π', '‚ù£Ô∏è', 'üíï', 'üíû', 'üíì', 'üíó', 'üíñ', 'üíò', 'üíù', 'üíü', '‚òÆÔ∏è', '‚úùÔ∏è', '‚ò™Ô∏è', 'üïâÔ∏è', '‚ò∏Ô∏è', '‚ú°Ô∏è', 'üîØ', 'üïé', '‚òØÔ∏è', '‚ò¶Ô∏è', 'üõê', '‚õé', '‚ôà', '‚ôâ', '‚ôä', '‚ôã', '‚ôå', '‚ôç', '‚ôé', '‚ôè', '‚ôê', '‚ôë', '‚ôí', '‚ôì', 'üÜî', '‚öõÔ∏è', 'üâë', '‚ò¢Ô∏è', '‚ò£Ô∏è', 'üì¥', 'üì≥', 'üà∂', 'üàö', 'üà∏', 'üà∫', 'üà∑Ô∏è', '‚ú¥Ô∏è', 'üÜö', 'üíÆ', 'üâê', '„äôÔ∏è', '„äóÔ∏è', 'üà¥', 'üàµ', 'üàπ', 'üà≤', 'üÖ∞Ô∏è', 'üÖ±Ô∏è', 'üÜé', 'üÜë', 'üÖæÔ∏è', 'üÜò', '‚ùå', '‚≠ï', 'üõë', '‚õî', 'üìõ', 'üö´', 'üíØ', 'üí¢', '‚ô®Ô∏è', 'üö∑', 'üöØ', 'üö≥', 'üö±', 'üîû', 'üìµ', 'üö≠', '‚ùó', '‚ùï', '‚ùì', '‚ùî', '‚ÄºÔ∏è', '‚ÅâÔ∏è', 'üîÖ', 'üîÜ', '„ÄΩÔ∏è', '‚ö†Ô∏è', 'üö∏', 'üî±', '‚öúÔ∏è', 'üî∞', '‚ôªÔ∏è', '‚úÖ', 'üàØ', 'üíπ', '‚ùáÔ∏è', '‚ú≥Ô∏è', '‚ùé', 'üåê', 'üí†', '‚ìÇÔ∏è', 'üåÄ', 'üí§', 'üèß', 'üöæ', '‚ôø', 'üÖøÔ∏è', 'üà≥', 'üàÇÔ∏è', 'üõÇ', 'üõÉ', 'üõÑ', 'üõÖ', 'üöπ', 'üö∫', 'üöº', '‚ößÔ∏è', 'üöª', 'üöÆ', 'üé¶', 'üì∂', 'üàÅ', 'üî£', '‚ÑπÔ∏è', 'üî§', 'üî°', 'üî†', 'üÜñ', 'üÜó', 'üÜô', 'üÜí', 'üÜï', 'üÜì', '0Ô∏è‚É£', '1Ô∏è‚É£', '2Ô∏è‚É£', '3Ô∏è‚É£', '4Ô∏è‚É£', '5Ô∏è‚É£', '6Ô∏è‚É£', '7Ô∏è‚É£', '8Ô∏è‚É£', '9Ô∏è‚É£', 'üîü', 'üî¢', '#Ô∏è‚É£', '*Ô∏è‚É£', '‚èèÔ∏è', '‚ñ∂Ô∏è', '‚è∏Ô∏è', '‚èØÔ∏è', '‚èπÔ∏è', '‚è∫Ô∏è', '‚è≠Ô∏è', '‚èÆÔ∏è', '‚è©', '‚è™', '‚è´', '‚è¨', '‚óÄÔ∏è', 'üîº', 'üîΩ', '‚û°Ô∏è', '‚¨ÖÔ∏è', '‚¨ÜÔ∏è', '‚¨áÔ∏è', '‚ÜóÔ∏è', '‚ÜòÔ∏è', '‚ÜôÔ∏è', '‚ÜñÔ∏è', '‚ÜïÔ∏è', '‚ÜîÔ∏è', '‚Ü™Ô∏è', '‚Ü©Ô∏è', '‚§¥Ô∏è', '‚§µÔ∏è', 'üîÄ', 'üîÅ', 'üîÇ', 'üîÑ', 'üîÉ', 'üéµ', 'üé∂', '‚ûï', '‚ûñ', '‚ûó', '‚úñÔ∏è', '‚ôæÔ∏è', 'üí≤', 'üí±', '‚Ñ¢Ô∏è', '¬©Ô∏è', '¬ÆÔ∏è', '„Ä∞Ô∏è', '‚û∞', '‚ûø', 'üîö', 'üîô', 'üîõ', 'üîù', 'üîú', '‚úîÔ∏è', '‚òëÔ∏è', 'üîò', 'üî¥', 'üü†', 'üü°', 'üü¢', 'üîµ', 'üü£', '‚ö´', '‚ö™', 'üü§', 'üî∫', 'üîª', 'üî∏', 'üîπ', 'üî∂', 'üî∑', 'üüß', 'üü®', 'üü©', 'üü¶', 'üü™', '‚¨õ', '‚¨ú', 'üü´', 'üî≥', 'üî≤', '‚ñ™Ô∏è', '‚ñ´Ô∏è', '‚óºÔ∏è', '‚óªÔ∏è', '‚óæ', '‚óΩ', 'üü•', 'üü®', 'üü©', 'üü¶', 'üü™', 'üü´', 'üîà', 'üîá', 'üîâ', 'üîä', 'üîî', 'üîï', 'üì£', 'üì¢', 'üëÅÔ∏è‚Äçüó®Ô∏è', 'üí¨', 'üí≠', 'üóØÔ∏è', '‚ô†Ô∏è', '‚ô£Ô∏è', '‚ô•Ô∏è', '‚ô¶Ô∏è', 'üÉè', 'üé¥', 'üÄÑ', 'üßø', 'ü™¨', 'üßß', 'üéè', 'üéé', 'üéê', 'üèÆ', 'üìø']
  }
]

export default {
  name: 'EmojiPicker',
  props: {
    modelValue: {
      type: Boolean,
      default: false
    },
    /** –í—ã—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –ø–∏–∫–µ—Ä –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é (–¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å–ø—Ä–∞–≤–∞ ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–ª–µ–≤–∞ –æ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è). */
    alignRight: { type: Boolean, default: false },
    /** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è (–¥–ª—è –ø–∏–∫–µ—Ä–∞ —Ä–µ–∞–∫—Ü–∏–π). */
    showCloseButton: { type: Boolean, default: false },
    /** –û—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–∏–∫–µ—Ä —Å–Ω–∏–∑—É –æ—Ç —Ç—Ä–∏–≥–≥–µ—Ä–∞ (–¥–ª—è —Ä–µ–∞–∫—Ü–∏–π ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç—Å—è). */
    positionBelow: { type: Boolean, default: false }
  },
  emits: ['update:modelValue', 'select', 'close'],
  data() {
    return {
      activeCategoryId: 'smileys',
      searchQuery: '',
      hoveredEmoji: null,
      categories: EMOJI_CATEGORIES.map(c => ({ 
        ...c, 
        emojis: c.id === 'recent' ? [] : [...c.emojis] 
      }))
    }
  },
  computed: {
    visibleCategories() {
      return this.categories.filter(cat => {
        if (cat.id === 'recent') {
          return cat.emojis && cat.emojis.length > 0
        }
        return true
      })
    },
    filteredCategories() {
      if (!this.searchQuery) {
        return this.visibleCategories
      }
      
      const search = this.searchQuery.toLowerCase()
      const allEmojis = this.categories.flatMap(cat => 
        cat.emojis.map(emoji => ({
          emoji,
          category: cat.id,
          name: this.getEmojiName(emoji) || ''
        }))
      )
      
      const filtered = allEmojis.filter(item => 
        item.name.toLowerCase().includes(search) ||
        item.emoji.includes(search)
      ).map(item => item.emoji)
      
      return [{
        id: 'search',
        label: '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞',
        icon: 'üîç',
        emojis: [...new Set(filtered)].slice(0, 100)
      }]
    }
  },
  watch: {
    modelValue(visible) {
      if (visible) {
        this.syncRecentFromStorage()
        // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è recent –∏ –Ω–µ—Ç —ç–º–æ–¥–∑–∏, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ smileys
        const recentCat = this.categories.find(c => c.id === 'recent')
        if (this.activeCategoryId === 'recent' && (!recentCat || recentCat.emojis.length === 0)) {
          this.activeCategoryId = 'smileys'
        }
      }
    }
  },
  mounted() {
    this.syncRecentFromStorage()
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    this.initializeEmojiData()
  },
  methods: {
    syncRecentFromStorage() {
      try {
        const raw = localStorage.getItem(RECENT_STORAGE_KEY)
        const list = raw ? JSON.parse(raw) : []
        const recent = Array.isArray(list) ? list.slice(0, RECENT_MAX) : []
        const cat = this.categories.find(c => c.id === 'recent')
        if (cat) cat.emojis = recent
        if (recent.length > 0 && this.activeCategoryId === 'smileys') {
          this.activeCategoryId = 'recent'
        }
      } catch (_) {
        const cat = this.categories.find(c => c.id === 'recent')
        if (cat) cat.emojis = []
      }
    },
    
    getEmojisForCategory(cat) {
      return cat.emojis || []
    },
    
    onSelect(emoji) {
      if (!emoji) return
      this.addToRecent(emoji)
      this.$emit('select', emoji)
      this.searchQuery = ''
    },
    
    addToRecent(emoji) {
      const cat = this.categories.find(c => c.id === 'recent')
      if (!cat) return
      let list = [...(cat.emojis || [])]
      list = list.filter(e => e !== emoji)
      list.unshift(emoji)
      list = list.slice(0, RECENT_MAX)
      cat.emojis = list
      try {
        localStorage.setItem(RECENT_STORAGE_KEY, JSON.stringify(list))
      } catch (_) {}
    },
    
    getEmojiName(emoji) {
      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π —ç–º–æ–¥–∑–∏
      // –ù–∞–ø—Ä–∏–º–µ—Ä, –∏—Å–ø–æ–ª—å–∑—É—è emoji-short-name –∏–ª–∏ –ø–æ–¥–æ–±–Ω—É—é
      // –≠—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
      const emojiNames = {
        'üòÄ': '—É–ª—ã–±–∫–∞',
        'üòÉ': '—à–∏—Ä–æ–∫–∞—è —É–ª—ã–±–∫–∞',
        'üòÑ': '—Å–º–µ—Ö',
        'üòÅ': '—Ä–∞–¥–æ—Å—Ç—å',
        'üòÜ': '—Ö–æ—Ö–æ—Ç',
        'üòÖ': '–æ–±–ª–µ–≥—á–µ–Ω–∏–µ',
        'üòÇ': '—Å–ª–µ–∑—ã —Ä–∞–¥–æ—Å—Ç–∏',
        // ... –¥–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ
      }
      return emojiNames[emoji] || emoji
    },
    
    initializeEmojiData() {
      // –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ —ç–º–æ–¥–∑–∏
      // –ù–∞–ø—Ä–∏–º–µ—Ä: import emojiData from 'emoji-short-name'
    }
  }
}
</script>

<style scoped>
.emoji-picker {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
}

/* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –∫–∞–∫ –≤ Telegram */
.emoji-picker ::-webkit-scrollbar {
  width: 8px;
}

.emoji-picker ::-webkit-scrollbar-track {
  background: transparent;
}

.emoji-picker ::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 4px;
}

.emoji-picker ::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}
</style>