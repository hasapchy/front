# –ê—É–¥–∏—Ç –∫—ç—à-—Å–µ—Ä–≤–∏—Å–∞ –∏ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2025-01-27  

**–¢–µ–∫—É—â–∏–π –¥—Ä–∞–π–≤–µ—Ä –∫—ç—à–∞:** `database` (–∏–∑ `config/cache.php`, –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `file`, –Ω–æ –≤ –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `database`)  

**–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–π –ø–µ—Ä–µ—Ö–æ–¥:** Redis

---

## 1. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### 1.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ CacheService

–ö—ç—à-—Å–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–ª–∞—Å—Å `App\Services\CacheService` —Å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

- `remember()` - –±–∞–∑–æ–≤—ã–π –º–µ—Ç–æ–¥ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å TTL
- `getPaginatedData()` - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `getReferenceData()` - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `invalidateByLike()` - –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É (LIKE)
- –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏

### 1.2. TTL –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

```php
const CACHE_TTL = [
    'sales_list' => 600,        // 10 –º–∏–Ω—É—Ç
    'reference_data' => 7200,   // 2 —á–∞—Å–∞
    'user_data' => 3600,        // 1 —á–∞—Å
    'search_results' => 300,     // 5 –º–∏–Ω—É—Ç
];
```

**–ê–Ω–∞–ª–∏–∑ TTL:**

- ‚úÖ –†–∞–∑—É–º–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- ‚ö†Ô∏è –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–µ—Ç –≥–∏–±–∫–æ—Å—Ç–∏
- ‚ö†Ô∏è –î–ª—è –ø–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `sales_list` (600 —Å–µ–∫), —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —á–∞—Å—Ç–æ –∏–∑–º–µ–Ω—è—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö

---

## 2. –ü—Ä–æ–±–ª–µ–º—ã –∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 2.1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –Ω–µ-database –¥—Ä–∞–π–≤–µ—Ä–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞ –≤ –º–µ—Ç–æ–¥–µ `invalidateOtherCache()`:**

```php
protected static function invalidateOtherCache(string $like, ?int $companyId, string $driver): void
{
    try {
        if ($companyId !== null) {
            $pattern = str_replace('%', '', $like) . "_{$companyId}";
            Cache::forget($pattern);
        } else {
            Cache::flush(); // ‚ùå –û–ü–ê–°–ù–û: –æ—á–∏—â–∞–µ—Ç –í–ï–°–¨ –∫—ç—à!
        }
    } catch (\Exception $e) {
        // Cache flush failed silently
    }
}
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**

1. ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ `companyId` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `Cache::flush()`** - —É–±—Ä–∞–Ω –æ–ø–∞—Å–Ω—ã–π –≤—ã–∑–æ–≤ `Cache::flush()`, —Ç–µ–ø–µ—Ä—å –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ `companyId` –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è (—Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è database –¥—Ä–∞–π–≤–µ—Ä, —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è)

2. ‚ö†Ô∏è **–ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–ª—è Redis/Memcached** - –º–µ—Ç–æ–¥ `forget()` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç wildcards, –ø–æ—ç—Ç–æ–º—É –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∞–∫—Ç—É–∞–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ Redis)

3. ‚ö†Ô∏è **–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ Redis —ç—Ç–æ —Å–ª–æ–º–∞–µ—Ç –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –∫—ç—à–∞** - —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Redis

**–†–µ—à–µ–Ω–∏–µ:**

- –î–ª—è Redis –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SCAN` + `KEYS` –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–ª—é—á–µ–π –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É
- –î–ª—è –¥—Ä—É–≥–∏—Ö –¥—Ä–∞–π–≤–µ—Ä–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –∫–ª—é—á–µ–π —á–µ—Ä–µ–∑ –∏—Ç–µ—Ä–∞—Ü–∏—é –∏–ª–∏ —Ç–µ–≥–∏ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)

### 2.2. –ü—Ä–æ–±–ª–µ–º–∞ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–ª—é—á–µ–π –∫—ç—à–∞

**–í `BaseRepository::generateCacheKey()`:**

```php
public function generateCacheKey(string $prefix, array $params = []): string
{
    $companyId = $this->getCurrentCompanyId() ?? 'default';
    $key = $prefix;
    foreach ($params as $param) {
        if ($param !== null && $param !== '') {
            $key .= "_{$param}";
        }
    }
    $key .= "_{$companyId}";
    return $key;
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. ‚ö†Ô∏è –ù–µ—Ç —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ - –µ—Å–ª–∏ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –µ—Å—Ç—å —Å–∏–º–≤–æ–ª—ã —Ç–∏–ø–∞ `_`, `:`, —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∫–æ–ª–ª–∏–∑–∏—è–º –∫–ª—é—á–µ–π

2. ‚ö†Ô∏è –ù–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ - –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–≥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `null` vs `''`)

3. ‚ö†Ô∏è –î–ª–∏–Ω–Ω—ã–µ –∫–ª—é—á–∏ - –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–ª—é—á–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–º–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `md5()` –∏–ª–∏ `hash()` –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ –∫–ª—é—á

### 2.3. –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–í `getPaginatedData()`:**

```php
public static function getPaginatedData(string $cacheKey, callable $callback, int $page = 1)
{
    $fullKey = "paginated_{$cacheKey}_page_{$page}";
    $ttl = self::CACHE_TTL['sales_list'];
    return self::remember($fullKey, $callback, $ttl);
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. ‚ö†Ô∏è –ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ - –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

2. ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û:** –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `invalidatePaginatedData()` –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ –±–∞–∑–æ–≤–æ–º—É –∫–ª—é—á—É

3. ‚ö†Ô∏è –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å—Ç—Ä–∞–Ω–∏—Ü —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—é –∫—ç—à–∞ (–∞–∫—Ç—É–∞–ª—å–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä–µ–º–µ –¥–∞–Ω–Ω—ã—Ö)

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:**

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç 50 —Å—Ç—Ä–∞–Ω–∏—Ü –∑–∞–∫–∞–∑–æ–≤
- –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `invalidateOrdersCache()` - –Ω–æ —ç—Ç–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º `%order%`
- –ö–ª—é—á–∏ —Ç–∏–ø–∞ `paginated_orders_paginated_..._page_1` –º–æ–≥—É—Ç –Ω–µ –ø–æ–ø–∞—Å—Ç—å –ø–æ–¥ –ø–∞—Ç—Ç–µ—Ä–Ω

### 2.4. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã

**–ú–µ—Ç–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:**

- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û:** `smartRemember()` - —É–¥–∞–ª–µ–Ω (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è)
- `rememberSearch()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `ClientsRepository`, –æ—Å—Ç–∞–≤–ª–µ–Ω
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û:** `preloadData()` - —É–¥–∞–ª–µ–Ω (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è)
- `clearUserCache()` - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤ –±—É–¥—É—â–µ–º)

### 2.5. –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

**–í–æ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–∞—Ö –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏:**

```php
try {
    // ... –∫–æ–¥ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
} catch (\Exception $e) {
    // –ú–æ–ª—á–∞–ª–∏–≤–æ–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. ‚ö†Ô∏è –û—à–∏–±–∫–∏ –∫—ç—à–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è –º–æ–ª—á–∞ - —ç—Ç–æ –º–æ–∂–µ—Ç —Å–∫—Ä—ã—Ç—å —Å–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

2. ‚ö†Ô∏è –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫

3. ‚ö†Ô∏è –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–±–ª–µ–º —Å –∫—ç—à–µ–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

- –í development –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∫—ç—à–µ–º

---

## 3. –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—ç—à–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö

### 3.1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

**–•–æ—Ä–æ—à–∏–µ –ø—Ä–∏–º–µ—Ä—ã:**

1. **ClientsRepository::getItemsWithPagination()** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–ª—é—á —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

```php
$cacheKey = $this->generateCacheKey('clients_paginated', [
    $perPage, $search, $includeInactive, $statusFilter, 
    $typeFilterKey, $currentUser?->id, $companyId
]);
```

2. **ClientsRepository::getItemById()** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π:

```php
$cacheKey = $this->generateCacheKey('client', [$id]);
return CacheService::getReferenceData($cacheKey, function () use ($id) {
    // ...
});
```

3. **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:**

```php
CacheService::invalidateClientsCache();
$this->invalidateClientBalanceCache($client->id);
```

### 3.2. –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**1. OrdersRepository::getItemsWithPagination()** - –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã–π –∫–ª—é—á:

```php
$cacheKey = $this->generateCacheKey('orders_paginated', [
    $userUuid, $perPage, $search, $dateFilter, $startDate, 
    $endDate, $statusFilter, $projectFilter, $clientFilter, 
    $unpaidOnly, 'single', $currentUser?->id, $companyId
]);
```

- ‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ - –∫–ª—é—á –±—É–¥–µ—Ç –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–º
- ‚ö†Ô∏è –•–∞—Ä–¥–∫–æ–¥ `'single'` –≤ –∫–ª—é—á–µ –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è

**2. TransactionsRepository::getItemsWithPagination()** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ md5 –¥–ª—è –ø–æ–∏—Å–∫–∞:

```php
$searchKey = $search !== null ? md5(trim((string)$search)) : 'null';
$cacheKey = $this->generateCacheKey('transactions_paginated', [
    $perPage, $cash_id, $date_filter_type, $order_id, $searchKey, 
    // ... –º–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
]);
```

- ‚úÖ –•–æ—Ä–æ—à–æ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `md5()` –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫
- ‚ö†Ô∏è –ù–æ: `'null'` –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∫–æ–ª–ª–∏–∑–∏—è–º

**3. ProjectsRepository::getItemsWithPagination()** - –∫–∞—Å—Ç–æ–º–Ω—ã–π TTL:

```php
$ttl = (!$search && $dateFilter === 'all_time' && !$statusId && !$clientId && $contractType === null) 
    ? 1800 
    : 600;
```

- ‚ö†Ô∏è –õ–æ–≥–∏–∫–∞ TTL –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –∞ –Ω–µ –≤ CacheService
- ‚ö†Ô∏è –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `getPaginatedData()`, –∞ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `remember()`

**4. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö:**

- –í `OrdersRepository::deleteItem()` –Ω–µ—Ç –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞ –∑–∞–∫–∞–∑–æ–≤
- –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Ç–æ–¥–∞—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π

### 3.3. –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ–¥–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫—ç—à–∞.

**–ü—Ä–∏–º–µ—Ä –∏–∑ OrdersRepository::updateItem():**

```php
CacheService::invalidateOrdersCache();
CacheService::invalidateClientsCache();
if ($client_id) {
    $this->invalidateClientBalanceCache($client_id);
}
if ($clientChanged && $oldClientId) {
    $this->invalidateClientBalanceCache($oldClientId);
}
if ($project_id) {
    $projectsRepository->invalidateProjectCache($project_id);
}
```

- ‚ö†Ô∏è `invalidateOrdersCache()` –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –í–°–ï –∫–ª—é—á–∏ —Å `%order%` - —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω–æ
- ‚ö†Ô∏è `invalidateClientsCache()` –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã, —Ö–æ—Ç—è –∏–∑–º–µ–Ω–∏–ª—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∑–∞–∫–∞–∑

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–µ—á–Ω—É—é –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é, –Ω–∞–ø—Ä–∏–º–µ—Ä:

- –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–≥–∏ –∫—ç—à–∞ (–µ—Å–ª–∏ Redis –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)

---

## 4. –ü—Ä–æ–±–ª–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Redis

### 4.1. –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è database

**–ú–µ—Ç–æ–¥ `invalidateDatabaseCache()`:**

```php
DB::table($cacheTable)->where('key', 'like', $like)->delete();
```

–≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è database, –Ω–æ:

- ‚ùå –ù–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è Redis (–Ω–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ LIKE)
- ‚ùå –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ Redis –≤—Å–µ –º–µ—Ç–æ–¥—ã –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–ª–æ–º–∞—é—Ç—Å—è

### 4.2. –ß—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–ª—è Redis

1. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤ Redis:**

```php
// –í–º–µ—Å—Ç–æ LIKE –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SCAN –∏–ª–∏ KEYS
$keys = Redis::keys($pattern);
foreach ($keys as $key) {
    Redis::del($key);
}
```

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–≥–æ–≤ (Redis tags):**

- Laravel Cache –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ–≥–∏ –¥–ª—è –≤—Å–µ—Ö –¥—Ä–∞–π–≤–µ—Ä–æ–≤
- –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç —Ç–∏–ø–∞ `spatie/laravel-tags` –∏–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–≤–æ—é —Å–∏—Å—Ç–µ–º—É —Ç–µ–≥–æ–≤

3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏:**

- –í Redis –ø—Ä–µ—Ñ–∏–∫—Å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ù—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å —ç—Ç–æ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

### 4.3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ Redis

1. **–°–æ–∑–¥–∞—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏:**

```php
protected static function invalidateByPattern(string $pattern, ?int $companyId): void
{
    $driver = config('cache.default');
    
    if ($driver === 'database') {
        self::invalidateDatabaseCache($pattern, $companyId);
    } elseif ($driver === 'redis') {
        self::invalidateRedisCache($pattern, $companyId);
    } else {
        self::invalidateOtherCache($pattern, $companyId, $driver);
    }
}
```

2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `invalidateRedisCache()`:**

```php
protected static function invalidateRedisCache(string $pattern, ?int $companyId): void
{
    $prefix = config('cache.prefix', '');
    $fullPattern = $prefix . $pattern;
    
    // –£—á–∏—Ç—ã–≤–∞–µ–º companyId –≤ –ø–∞—Ç—Ç–µ—Ä–Ω–µ
    if ($companyId !== null) {
        $fullPattern = rtrim($fullPattern, '%') . "%_{$companyId}%";
    }
    
    $redis = \Illuminate\Support\Facades\Redis::connection('cache');
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º SQL LIKE –ø–∞—Ç—Ç–µ—Ä–Ω –≤ Redis –ø–∞—Ç—Ç–µ—Ä–Ω
    $redisPattern = str_replace('%', '*', $fullPattern);
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º SCAN –¥–ª—è production (KEYS –±–ª–æ–∫–∏—Ä—É–µ—Ç Redis)
    $cursor = 0;
    $keysToDelete = [];
    
    do {
        $result = $redis->scan($cursor, [
            'match' => $redisPattern,
            'count' => 100
        ]);
        
        $cursor = $result[0];
        $keys = $result[1];
        
        foreach ($keys as $key) {
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω Laravel
            $cleanKey = str_replace($prefix, '', $key);
            $keysToDelete[] = $cleanKey;
        }
    } while ($cursor !== 0);
    
    if (!empty($keysToDelete)) {
        // –£–¥–∞–ª—è–µ–º –∫–ª—é—á–∏ –±–∞—Ç—á–∞–º–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        $chunks = array_chunk($keysToDelete, 100);
        foreach ($chunks as $chunk) {
            $redis->del($chunk);
        }
    }
}
```

3. **–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–≥–æ–≤:**

- –¢–µ–≥–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≥—Ä—É–ø–ø—ã –∫–ª—é—á–µ–π
- –ù–æ —Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## 5. –û—Ü–µ–Ω–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### 5.1. –ì–¥–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ

‚úÖ **–°–ø—Ä–∞–≤–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (reference_data):**

- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏, —Å—Ç–∞—Ç—É—Å—ã, –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è
- –†–µ–¥–∫–æ –∏–∑–º–µ–Ω—è—é—Ç—Å—è
- –ß–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è
- TTL 2 —á–∞—Å–∞ - —Ä–∞–∑—É–º–Ω–æ

‚úÖ **–ü–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏:**

- –°–Ω–∏–∂–∞—é—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ë–î
- –û—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º JOIN
- TTL 10 –º–∏–Ω—É—Ç - —Ä–∞–∑—É–º–Ω–æ –¥–ª—è —á–∞—Å—Ç–æ –∏–∑–º–µ–Ω—è—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö

‚úÖ **–û—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ ID:**

- –ö–ª–∏–µ–Ω—Ç—ã, –∑–∞–∫–∞–∑—ã, –ø—Ä–æ–µ–∫—Ç—ã
- –ß–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- TTL 2 —á–∞—Å–∞ - –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω–æ, –ª—É—á—à–µ 30-60 –º–∏–Ω—É—Ç

### 5.2. –ì–¥–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–º

‚ö†Ô∏è **–ü–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–µ–¥–∫–æ –ø–æ–≤—Ç–æ—Ä—è—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ö—ç—à –º–æ–∂–µ—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è
- TTL 5 –º–∏–Ω—É—Ç - —Ä–∞–∑—É–º–Ω–æ, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∏–∑–∫–∞—è

‚ö†Ô∏è **–î–∞–Ω–Ω—ã–µ —Å —á–∞—Å—Ç—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏:**

- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –±–∞–ª–∞–Ω—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ò–∑–º–µ–Ω—è—é—Ç—Å—è –æ—á–µ–Ω—å —á–∞—Å—Ç–æ
- –ö—ç—à –º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ —É—Å—Ç–∞—Ä–µ–≤–∞—Ç—å
- –ù—É–∂–Ω–∞ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è

‚ö†Ô∏è **–î–∞–Ω–Ω—ã–µ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:**

- –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫—ç—à –º–æ–∂–µ—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è
- –ö–∞–∂–¥–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è = –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª—é—á
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—é –∫—ç—à–∞

### 5.3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–£–º–µ–Ω—å—à–∏—Ç—å TTL –¥–ª—è —á–∞—Å—Ç–æ –∏–∑–º–µ–Ω—è—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö:**

   - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: 5-10 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 10
   - –ó–∞–∫–∞–∑—ã: 5 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 10
   - –ë–∞–ª–∞–Ω—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤: –Ω–µ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ TTL 1-2 –º–∏–Ω—É—Ç—ã

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å–ª–æ–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**

   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - –ò–ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ N —Å—Ç—Ä–∞–Ω–∏—Ü

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ hit rate:**

   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø–∞–¥–∞–Ω–∏–π/–ø—Ä–æ–º–∞—Ö–æ–≤ –∫—ç—à–∞
   - –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

---

## 6. –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 6.1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

1. ‚ùå **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –Ω–µ-database –¥—Ä–∞–π–≤–µ—Ä–æ–≤ —Å–ª–æ–º–∞–Ω–∞:**

   - `Cache::flush()` –æ—á–∏—â–∞–µ—Ç –≤–µ—Å—å –∫—ç—à –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω-–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è Redis/Memcached
   - **–î–µ–π—Å—Ç–≤–∏–µ:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ Redis

2. ‚ùå **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Redis:**

   - –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å database
   - –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ Redis –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
   - **–î–µ–π—Å—Ç–≤–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É Redis –¥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞

### 6.2. –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å)

1. ‚ö†Ô∏è **–ò–∑–±—ã—Ç–æ—á–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è:**

   - –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö, —á–µ–º –Ω—É–∂–Ω–æ
   - –°–Ω–∏–∂–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—ç—à–∞
   - **–î–µ–π—Å—Ç–≤–∏–µ:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—á–µ—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã

2. ‚ö†Ô∏è **–î–ª–∏–Ω–Ω—ã–µ –∫–ª—é—á–∏ –∫—ç—à–∞:**

   - –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–ª—é—á–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–º–∏
   - –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
   - **–î–µ–π—Å—Ç–≤–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

3. ‚ö†Ô∏è **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**

   - –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –∫—ç—à–∞
   - –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫—ç—à–∞
   - **–î–µ–π—Å—Ç–≤–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç—Ä–∏–∫–∏

### 6.3. –£–ª—É—á—à–µ–Ω–∏—è (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ–∑–∂–µ)

1. üí° **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–≥–æ–≤ –∫—ç—à–∞:**

   - –ü–æ–∑–≤–æ–ª–∏—Ç –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≥—Ä—É–ø–ø—ã –∫–ª—é—á–µ–π
   - –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

2. üí° **–£—Å–ª–æ–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**

   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
   - –°–Ω–∏–∑–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–ª—é—á–µ–π

3. üí° **–£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –º–µ—Ç–æ–¥–æ–≤:**

   - –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–¥ –æ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –º–µ—Ç–æ–¥–æ–≤
   - –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É

### 6.4. –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ Redis

1. **–≠—Ç–∞–ø 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–±–ª–µ–º**

   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å `invalidateOtherCache()` - —É–±—Ä–∞—Ç—å `Cache::flush()`
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–ª—é—á–µ–π

2. **–≠—Ç–∞–ø 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ Redis**

   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `invalidateRedisCache()` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SCAN
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ —Å Redis
   - –î–æ–±–∞–≤–∏—Ç—å fallback –Ω–∞ database –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö Redis

3. **–≠—Ç–∞–ø 3: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Redis**

   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Redis –≤ production
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
   - –°—Ä–∞–≤–Ω–∏—Ç—å —Å database –∫—ç—à–µ–º

4. **–≠—Ç–∞–ø 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**

   - –ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫—ç—à–∞
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TTL –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É
   - –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## 7. –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### 7.1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ invalidateOtherCache()

```php
protected static function invalidateOtherCache(string $like, ?int $companyId, string $driver): void
{
    try {
        if ($driver === 'redis') {
            self::invalidateRedisCache($like, $companyId);
            return;
        }
        
        // –î–ª—è –¥—Ä—É–≥–∏—Ö –¥—Ä–∞–π–≤–µ—Ä–æ–≤ (file, memcached) –ø–∞—Ç—Ç–µ—Ä–Ω-–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
        // –ú–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏
        // –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º Cache::flush() - —ç—Ç–æ –æ—á–∏—Å—Ç–∏—Ç –≤–µ—Å—å –∫—ç—à!
    } catch (\Exception $e) {
    }
}
```

### 7.2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è invalidateRedisCache()

```php
protected static function invalidateRedisCache(string $pattern, ?int $companyId): void
{
    try {
        $prefix = config('cache.prefix', '');
        $fullPattern = $pattern;
        
        // –£—á–∏—Ç—ã–≤–∞–µ–º companyId –≤ –ø–∞—Ç—Ç–µ—Ä–Ω–µ
        if ($companyId !== null) {
            $fullPattern = rtrim($fullPattern, '%') . "%_{$companyId}%";
        }
        
        $redis = \Illuminate\Support\Facades\Redis::connection('cache');
        
        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º SQL LIKE –ø–∞—Ç—Ç–µ—Ä–Ω –≤ Redis –ø–∞—Ç—Ç–µ—Ä–Ω
        $redisPattern = str_replace('%', '*', $fullPattern);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
        if ($prefix) {
            $redisPattern = $prefix . $redisPattern;
        }
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º SCAN –¥–ª—è production (KEYS –±–ª–æ–∫–∏—Ä—É–µ—Ç Redis)
        $cursor = 0;
        $keysToDelete = [];
        
        do {
            $result = $redis->scan($cursor, [
                'match' => $redisPattern,
                'count' => 100
            ]);
            
            $cursor = $result[0];
            $keys = $result[1];
            
            foreach ($keys as $key) {
                // –£–¥–∞–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞
                $cleanKey = $prefix ? str_replace($prefix, '', $key) : $key;
                $keysToDelete[] = $cleanKey;
            }
        } while ($cursor !== 0);
        
        if (!empty($keysToDelete)) {
            // –£–¥–∞–ª—è–µ–º –∫–ª—é—á–∏ –±–∞—Ç—á–∞–º–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            $chunks = array_chunk($keysToDelete, 100);
            foreach ($chunks as $chunk) {
                Cache::forget($chunk);
            }
        }
    } catch (\Exception $e) {
    }
}
```

### 7.3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –∫—ç—à–∞

```php
public function generateCacheKey(string $prefix, array $params = []): string
{
    $companyId = $this->getCurrentCompanyId() ?? 'default';
    $key = $prefix;
    
    foreach ($params as $param) {
        if ($param === null) {
            continue;
        }
        
        $normalized = $this->normalizeCacheParam($param);
        
        // –î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ö–µ—à
        if (strlen($normalized) > 50) {
            $normalized = md5($normalized);
        }
        
        $key .= "_{$normalized}";
    }
    
    $key .= "_{$companyId}";
    
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –∫–ª—é—á–∞
    if (strlen($key) > 250) {
        $hash = md5($key);
        $key = substr($key, 0, 200) . "_{$hash}";
    }
    
    return $key;
}

protected function normalizeCacheParam($param): string
{
    if (is_bool($param)) {
        return $param ? '1' : '0';
    }
    
    if (is_array($param)) {
        sort($param);
        return implode(',', $param);
    }
    
    return (string) $param;
}
```

### 7.4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç–æ–¥—ã –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏

```php
protected static function invalidateDatabaseCache(string $like, ?int $companyId): void
{
    try {
        $cacheTable = config('cache.stores.database.table', 'cache');
        $prefix = config('cache.prefix');
        $originalPattern = $like;

        if ($prefix && strpos($like, '%') === 0) {
            $cleanPattern = trim($like, '%');
            $like = $prefix . '%' . $cleanPattern . '%';
        }

        if ($companyId !== null) {
            $like = rtrim($like, '%') . "%_{$companyId}%";
        }

        $deleted = DB::table($cacheTable)->where('key', 'like', $like)->delete();
    } catch (\Exception $e) {
    }
}
```

### 7.5. –£–ª—É—á—à–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ getPaginatedData —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏

```php
public static function getPaginatedData(string $cacheKey, callable $callback, int $page = 1)
{
    $fullKey = "paginated_{$cacheKey}_page_{$page}";
    $ttl = self::CACHE_TTL['sales_list'];

    return self::remember($fullKey, $callback, $ttl);
}

public static function invalidatePaginatedData(string $baseKey): void
{
    // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –±–∞–∑–æ–≤–æ–≥–æ –∫–ª—é—á–∞
    $pattern = "paginated_{$baseKey}_page_%";
    self::invalidateByLike($pattern);
}
```

---

## 8. –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 8.1. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

**–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Å–¥–µ–ª–∞—Ç—å –¥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ Redis):**

1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å `invalidateOtherCache()` - —É–±—Ä–∞—Ç—å `Cache::flush()`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `invalidateRedisCache()` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π SCAN
3. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ –º–µ—Ç–æ–¥—ã –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):**

1. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–ª—é—á–µ–π –∫—ç—à–∞
2. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ `OrdersRepository::deleteItem()`
3. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

**–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å):**

1. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã
2. –í–Ω–µ–¥—Ä–∏—Ç—å —Ç–µ–≥–∏ –∫—ç—à–∞
3. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ hit rate

### 8.2. –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ Redis

- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `invalidateOtherCache()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `invalidateRedisCache()`
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Redis
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ –Ω–∞ database

### 8.3. –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–ü–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ Redis —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:

1. **Hit rate –∫—ç—à–∞** - –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à
2. **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ Redis** - –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 10ms
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ Redis** - –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 80%
4. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏** - –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
5. **–û—à–∏–±–∫–∏ –∫—ç—à–∞** - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏

### 8.4. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫—ç—à-—Å–µ—Ä–≤–∏—Å–∞ –∏–º–µ–µ—Ç —Å–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ Redis. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å `Cache::flush()` –≤ `invalidateOtherCache()`
2. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Redis –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω-–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
3. ‚ö†Ô∏è –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞
4. ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç—Ç–∏—Ö –ø—Ä–æ–±–ª–µ–º —Å–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–∞ –∫ –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ Redis –∏ —Å–º–æ–∂–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ production –æ–∫—Ä—É–∂–µ–Ω–∏–∏.

---

## 9. –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 9.1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–±–ª–µ–º—ã —Å Cache::flush() (2025-01-27)

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –º–µ—Ç–æ–¥–µ `invalidateOtherCache()` –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ `companyId` –≤—ã–ø–æ–ª–Ω—è–ª—Å—è `Cache::flush()`, —á—Ç–æ –æ—á–∏—â–∞–ª–æ –≤–µ—Å—å –∫—ç—à –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –£–±—Ä–∞–Ω –æ–ø–∞—Å–Ω—ã–π –≤—ã–∑–æ–≤ `Cache::flush()`
- –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –º–µ—Ç–æ–¥–∞: –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ `companyId` –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- –î–ª—è database –¥—Ä–∞–π–≤–µ—Ä–∞ (—Ç–µ–∫—É—â–∏–π) –º–µ—Ç–æ–¥ `invalidateOtherCache()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –ø–æ—ç—Ç–æ–º—É –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–π –∫–æ–¥:**
```php
protected static function invalidateOtherCache(string $like, ?int $companyId, string $driver): void
{
    try {
        if ($companyId !== null) {
            $pattern = str_replace('%', '', $like) . "_{$companyId}";
            Cache::forget($pattern);
        }
    } catch (\Exception $e) {
    }
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 9.2. –£–ª—É—á—à–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π –∫—ç—à–∞ (2025-01-27)

**–ü—Ä–æ–±–ª–µ–º–∞:** –í–æ–∑–º–æ–∂–Ω—ã –∫–æ–ª–ª–∏–∑–∏–∏ –∏ —á—Ä–µ–∑–º–µ—Ä–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–ª—é—á–µ–π –∏–∑-–∑–∞ –Ω–µ–æ—á–∏—â–µ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–±—É–ª–µ–≤—ã, –º–∞—Å—Å–∏–≤—ã, —Å—Ç—Ä–æ–∫–∏)
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ —É—Å–µ—á–µ–Ω–∏–µ –∫–ª—é—á–∞ —Å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º —Ö–µ—à–µ–º
- –ü—Ä–æ–ø—É—Å–∫ –ø—É—Å—Ç—ã—Ö –∏ null-–∑–Ω–∞—á–µ–Ω–∏–π

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–π –∫–æ–¥:**
```php
public function generateCacheKey(string $prefix, array $params = []): string
{
    $companyId = $this->getCurrentCompanyId() ?? 'default';
    $key = $prefix;
    foreach ($params as $param) {
        if ($param === null) {
            continue;
        }
        $normalized = $this->normalizeCacheParam($param);
        if ($normalized === '') {
            continue;
        }
        if (strlen($normalized) > 50) {
            $normalized = md5($normalized);
        }
        $key .= "_{$normalized}";
    }
    $key .= "_{$companyId}";
    if (strlen($key) > 250) {
        $hash = md5($key);
        $key = substr($key, 0, 200) . "_{$hash}";
    }
    return $key;
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 9.2. –£–ª—É—á—à–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π –∫—ç—à–∞ (2025-01-27)

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –º–µ—Ç–æ–¥–µ `generateCacheKey()` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —á—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –∫–æ–ª–ª–∏–∑–∏—è–º –∫–ª—é—á–µ–π –∏ –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–º –∫–ª—é—á–∞–º.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (bool, –º–∞—Å—Å–∏–≤—ã, —Å—Ç—Ä–æ–∫–∏)
- –î–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ (>50 —Å–∏–º–≤–æ–ª–æ–≤) —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `md5()`
- –ö–ª—é—á–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –¥–ª–∏–Ω–æ–π 250 —Å–∏–º–≤–æ–ª–æ–≤ —Å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º —Ö–µ—à–µ–º
- –î–æ–±–∞–≤–ª–µ–Ω –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ `normalizeCacheParam()`

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–π –∫–æ–¥:**
```php
public function generateCacheKey(string $prefix, array $params = []): string
{
    $companyId = $this->getCurrentCompanyId() ?? 'default';
    $key = $prefix;
    foreach ($params as $param) {
        if ($param === null) {
            continue;
        }
        $normalized = $this->normalizeCacheParam($param);
        if ($normalized === '') {
            continue;
        }
        if (strlen($normalized) > 50) {
            $normalized = md5($normalized);
        }
        $key .= "_{$normalized}";
    }
    $key .= "_{$companyId}";
    if (strlen($key) > 250) {
        $hash = md5($key);
        $key = substr($key, 0, 200) . "_{$hash}";
    }
    return $key;
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 9.3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –º–µ—Ç–æ–¥–æ–≤ (2025-01-27)

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –ù–µ –±—ã–ª–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –í –∫–æ–¥–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã `smartRemember()` –∏ `preloadData()`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `invalidatePaginatedData()` –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ –±–∞–∑–æ–≤–æ–º—É –∫–ª—é—á—É
- –£–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã `smartRemember()` –∏ `preloadData()`
- –ú–µ—Ç–æ–¥ `rememberSearch()` –æ—Å—Ç–∞–≤–ª–µ–Ω, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `ClientsRepository`

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:**
```php
public static function invalidatePaginatedData(string $baseKey, ?int $companyId = null): void
{
    $pattern = "paginated_{$baseKey}_page_%";
    self::invalidateByLike($pattern, $companyId);
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

**–ê–≤—Ç–æ—Ä –∞—É–¥–∏—Ç–∞:** AI Assistant  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-01-27  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-27