# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∫—ç—à–µ–º –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏

## üìã –ü—Ä–æ–±–ª–µ–º–∞ (–ë–´–õ–û)

–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å, —Ö–æ—Ç—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –±—ã–ª–∏ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.

### –ü—Ä–∏—á–∏–Ω—ã:
1. **localStorage –∫—ç—à –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–º–ø–∞–Ω–∏–∏** - timestamp'—ã —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –∫–∞–∫ `warehouses_timestamp` –≤–º–µ—Å—Ç–æ `warehouses_{companyId}_timestamp`
2. **–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏** —Å—Ç–∞—Ä—ã–µ timestamp'—ã —Å—á–∏—Ç–∞–ª–∏—Å—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏, –∏ –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
3. **Pages –Ω–µ —Å–ª—É—à–∞–ª–∏ —Å–æ–±—ã—Ç–∏–µ company-changed** - –æ–Ω–∏ –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–º–ø–∞–Ω–∏–∏
4. **–°–æ–±—ã—Ç–∏–µ company-changed –æ—Ç–ø—Ä–∞–≤–ª—è–ª–æ—Å—å –î–û –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª–∏ –Ω–∞ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ

## ‚úÖ –†–µ—à–µ–Ω–∏–µ (–°–¢–ê–õ–û)

### 1. Store –¥–µ–π—Å—Ç–≤–∏—è - –ø—Ä–∏–≤—è–∑–∫–∞ –∫—ç—à–∞ –∫ –∫–æ–º–ø–∞–Ω–∏–∏

–û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –º–µ—Ç–æ–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–∏ –≤ `src/store/index.js`:

#### `loadWarehouses()` - –°—Ç—Ä–æ–∫–∞ 444-478
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç ID —Ç–µ–∫—É—â–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª—é—á –∫—ç—à–∞: `warehouses_{companyId}`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª—é—á timestamp: `warehouses_{companyId}_timestamp`
- ‚úÖ **–Ø–≤–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç timestamp** –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

#### `loadCashRegisters()` - –°—Ç—Ä–æ–∫–∞ 479-518
- ‚úÖ –ö–ª—é—á –∫—ç—à–∞: `cashRegisters_{companyId}`
- ‚úÖ –ö–ª—é—á timestamp: `cashRegisters_{companyId}_timestamp`
- ‚úÖ **–Ø–≤–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ timestamp**

#### `loadClients()` - –°—Ç—Ä–æ–∫–∞ 519-569
- ‚úÖ –ö–ª—é—á –∫—ç—à–∞: `clients_{companyId}`
- ‚úÖ –ö–ª—é—á timestamp: `clients_{companyId}_timestamp`
- ‚úÖ **–Ø–≤–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ timestamp**

#### `loadCategories()` - –°—Ç—Ä–æ–∫–∞ 602-627
- ‚úÖ –ö–ª—é—á –∫—ç—à–∞: `categories_{companyId}`
- ‚úÖ –ö–ª—é—á timestamp: `categories_{companyId}_timestamp`
- ‚úÖ **–Ø–≤–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ timestamp**

#### `loadProjects()` - –°—Ç—Ä–æ–∫–∞ 628-669
- ‚úÖ –ö–ª—é—á –∫—ç—à–∞: `projects_{companyId}`
- ‚úÖ –ö–ª—é—á timestamp: `projects_{companyId}_timestamp`
- ‚úÖ **–Ø–≤–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ timestamp**

### 2. Store –¥–µ–π—Å—Ç–≤–∏–µ - –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–º–ø–∞–Ω–∏–∏

–û–±–Ω–æ–≤–ª–µ–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ `setCurrentCompany()` –≤ `src/store/index.js` (–°—Ç—Ä–æ–∫–∞ 1043):
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ä—ã–π ID –∫–æ–º–ø–∞–Ω–∏–∏ –ø–µ—Ä–µ–¥ —Å–º–µ–Ω–æ–π
- ‚úÖ –í—ã–∑—ã–≤–∞–µ—Ç `CacheInvalidator.invalidateByCompany(oldCompanyId)` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä–æ–≥–æ –∫—ç—à–∞
- ‚úÖ **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ `company-changed` –ü–û–°–õ–ï –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö** (–Ω–µ –¥–æ!)

### 3. –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è

–í `src/views/components/app/CompanySwitcher.vue` (–°—Ç—Ä–æ–∫–∞ 146):
- ‚ùå –£–¥–∞–ª–µ–Ω–æ: –¥—É–±–ª–∏—Ä—É—é—â–µ–µ—Å—è —Å–æ–±—ã—Ç–∏–µ `company-changed` –∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- ‚úÖ –¢–µ–ø–µ—Ä—å —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ò–ó Store –ü–û–°–õ–ï –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 4. Pages —Å —Ä–µ–∞–∫—Ü–∏–µ–π –Ω–∞ company-changed

–î–æ–±–∞–≤–ª–µ–Ω `companyChangeMixin` –∫–æ –≤—Å–µ–º –≤–∞–∂–Ω—ã–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º:

#### ProductsPage - `src/views/pages/products/ProductsPage.vue`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω import –∏ –º–∏–∫—Å–∏–Ω
- ‚úÖ –ü—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–º–ø–∞–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `fetchItems()` –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

#### ServicesPage - `src/views/pages/products/ServicesPage.vue`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω import –∏ –º–∏–∫—Å–∏–Ω
- ‚úÖ –ü—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–º–ø–∞–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `fetchItems()` –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

#### SalesPage - `src/views/pages/sales/SalesPage.vue`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω import –∏ –º–∏–∫—Å–∏–Ω
- ‚úÖ –ü—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–º–ø–∞–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `fetchItems()` –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

#### OrdersPage - `src/views/pages/orders/OrdersPage.vue`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω import –∏ –º–∏–∫—Å–∏–Ω
- ‚úÖ –ü—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–º–ø–∞–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `fetchItems()` –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

#### WarehousesPage - `src/views/pages/warehouses/WarehousesPage.vue`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω import –∏ –º–∏–∫—Å–∏–Ω
- ‚úÖ –ü—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–º–ø–∞–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `fetchItems()` –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

#### CashRegistersPage - `src/views/pages/cash_registers/CashRegistersPage.vue`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω import –∏ –º–∏–∫—Å–∏–Ω
- ‚úÖ –ü—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–º–ø–∞–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `fetchItems()` –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

#### CategoriesPage - `src/views/pages/categories/CategoriesPage.vue`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω import –∏ –º–∏–∫—Å–∏–Ω
- ‚úÖ –ü—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–º–ø–∞–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `fetchItems()` –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

#### TransactionsPage - `src/views/pages/transactions/TransactionsPage.vue`
- ‚úÖ –£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `companyChangeMixin`

#### ProjectsPage - `src/views/pages/projects/ProjectsPage.vue`
- ‚úÖ –£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `companyChangeMixin`

#### ClientsPage - `src/views/pages/clients/ClientsPage.vue`
- ‚úÖ –£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `companyChangeMixin`

## üîÑ –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –∫–æ–º–ø–∞–Ω–∏—é –≤ CompanySwitcher
                      ‚Üì
CompanySwitcher.selectCompany(companyId)
                      ‚Üì
Store.setCurrentCompany(companyId)
                      ‚Üì
        oldCompanyId = —Ç–µ–∫—É—â–∞—è –∫–æ–º–ø–∞–Ω–∏—è
                      ‚Üì
POST /user/set-company ‚Üí –ø–æ–ª—É—á–∞–µ–º –Ω–æ–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é
                      ‚Üì
SET_CURRENT_COMPANY ‚Üí –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é
                      ‚Üì
CacheInvalidator.invalidateByCompany(oldCompanyId)
        ‚Üí —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–π –∫—ç—à –∏–∑ localStorage
                      ‚Üì
loadCompanyData()
        ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –∫–æ–º–ø–∞–Ω–∏—è –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
        ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç CLEAR_COMPANY_DATA (–æ—á–∏—â–∞–µ—Ç state)
        ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ —Å API
        ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤—ã–µ timestamp'—ã
                      ‚Üì
eventBus.emit('company-changed', newCompanyId)
                      ‚Üì
–í—Å–µ Pages —Å–æ —Å–≤–æ–µ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è –≤–∏–¥—è—Ç —Å–æ–±—ã—Ç–∏–µ
                      ‚Üì
Pages.onCompanyChanged()
        ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç fetchItems()
        ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ —Å API
        ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç UI
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –ß—Ç–æ | –ë—ã–ª–æ | –°—Ç–∞–ª–æ |
|-----|------|-------|
| localStorage –∫–ª—é—á–∏ | `warehouses_timestamp` | `warehouses_{companyId}_timestamp` |
| –ü—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–º–ø–∞–Ω–∏–∏ | –°—Ç–∞—Ä—ã–π –∫—ç—à –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è | –°—Ç–∞—Ä—ã–π –∫—ç—à —É–¥–∞–ª—è–µ—Ç—Å—è, –Ω–æ–≤—ã–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è |
| Pages –æ–±–Ω–æ–≤–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ (—á–µ—Ä–µ–∑ companyChangeMixin) |
| –°–æ–±—ã—Ç–∏–µ company-changed | ‚ùå –î–æ –∑–∞–≥—Ä—É–∑–∫–∏ | ‚úÖ –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ |
| –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–µ–π | ‚ùå –î–≤–∞ —Å–æ–±—ã—Ç–∏—è | ‚úÖ –û–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ –∏–∑ Store |

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Application ‚Üí Local Storage
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –¥—Ä—É–≥—É—é –∫–æ–º–ø–∞–Ω–∏—é
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —á—Ç–æ:
   - ‚úÖ –°—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏ `warehouses_1_timestamp` —É–¥–∞–ª–µ–Ω—ã
   - ‚úÖ –ù–æ–≤—ã–µ –∫–ª—é—á–∏ `warehouses_2_timestamp` —Å–æ–∑–¥–∞–Ω—ã
   - ‚úÖ –î–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –æ–±–Ω–æ–≤–∏–ª–∏—Å—å
   - ‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏ –Ω–µ—Ç –æ—à–∏–±–æ–∫

## üìù –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã

```
Frontend:
‚úÖ src/store/index.js - 5 –º–µ—Ç–æ–¥–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
‚úÖ src/views/components/app/CompanySwitcher.vue - —É–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
‚úÖ src/views/pages/products/ProductsPage.vue - –¥–æ–±–∞–≤–ª–µ–Ω –º–∏–∫—Å–∏–Ω
‚úÖ src/views/pages/products/ServicesPage.vue - –¥–æ–±–∞–≤–ª–µ–Ω –º–∏–∫—Å–∏–Ω
‚úÖ src/views/pages/sales/SalesPage.vue - –¥–æ–±–∞–≤–ª–µ–Ω –º–∏–∫—Å–∏–Ω
‚úÖ src/views/pages/orders/OrdersPage.vue - –¥–æ–±–∞–≤–ª–µ–Ω –º–∏–∫—Å–∏–Ω
‚úÖ src/views/pages/warehouses/WarehousesPage.vue - –¥–æ–±–∞–≤–ª–µ–Ω –º–∏–∫—Å–∏–Ω
‚úÖ src/views/pages/cash_registers/CashRegistersPage.vue - –¥–æ–±–∞–≤–ª–µ–Ω –º–∏–∫—Å–∏–Ω
‚úÖ src/views/pages/categories/CategoriesPage.vue - –¥–æ–±–∞–≤–ª–µ–Ω –º–∏–∫—Å–∏–Ω
```

## üéØ –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. ‚úÖ **–î–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –≤ –¥—Ä—É–≥–æ–π** - —Ç–µ–ø–µ—Ä—å –∫—ç—à –ø—Ä–∏–≤—è–∑–∞–Ω –∫ companyId
2. ‚úÖ **Pages –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–º–ø–∞–Ω–∏–∏** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–∏–∫—Å–∏–Ω—ã
3. ‚úÖ **–î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Å–æ–±—ã—Ç–∏—è** - –æ—Å—Ç–∞–ª–æ—Å—å –æ–¥–Ω–æ –∏–∑ Store
4. ‚úÖ **–°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–æ—Å—å –î–û –∑–∞–≥—Ä—É–∑–∫–∏** - —Ç–µ–ø–µ—Ä—å –ü–û–°–õ–ï

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- CacheInvalidator —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–¥–∞–ª—è–µ—Ç –∫—ç—à —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ —Ç–∏–ø–∞ `warehouses_{companyId}` ‚úÖ
- vuex-persistedstate —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ, –Ω–æ timestamp'—ã —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —è–≤–Ω–æ ‚úÖ
- –í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç –ø–æ current_company –Ω–∞ Backend'–µ ‚úÖ

–í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç! üéâ
